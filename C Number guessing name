#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <stdbool.h>

// Function to clear input buffer
void clearInputBuffer() {
    int c;
    while ((c = getchar()) != '\n' && c != EOF);
}

int main() {
    // Initialize random number generator
    srand(time(0));
    
    int maxNumber = 100;
    int difficulty = 1;
    int maxAttempts = 0;
    int score = 0;
    int playAgain = 1;
    
    printf("========================================\n");
    printf("      ENHANCED NUMBER GUESSING GAME\n");
    printf("========================================\n\n");
    
    while (playAgain) {
        // Difficulty selection
        printf("Select difficulty level:\n");
        printf("1. Easy (1-50, 10 attempts)\n");
        printf("2. Medium (1-100, 7 attempts)\n");
        printf("3. Hard (1-200, 5 attempts)\n");
        printf("Enter your choice (1-3): ");
        
        if (scanf("%d", &difficulty) != 1 || difficulty < 1 || difficulty > 3) {
            printf("Invalid input! Using Medium difficulty.\n");
            difficulty = 2;
            clearInputBuffer();
        }
        
        // Set game parameters based on difficulty
        switch (difficulty) {
            case 1:
                maxNumber = 50;
                maxAttempts = 10;
                break;
            case 2:
                maxNumber = 100;
                maxAttempts = 7;
                break;
            case 3:
                maxNumber = 200;
                maxAttempts = 5;
                break;
        }
        
        // Generate random number
        int secretNumber = rand() % maxNumber + 1;
        int guess;
        int attempts = 0;
        bool hasGuessedCorrectly = false;
        
        printf("\nI've selected a number between 1 and %d.\n", maxNumber);
        printf("You have %d attempts to guess it. Good luck!\n\n", maxAttempts);
        
        // Game loop
        while (attempts < maxAttempts && !hasGuessedCorrectly) {
            printf("Attempt %d/%d - Enter your guess: ", attempts + 1, maxAttempts);
            
            if (scanf("%d", &guess) != 1) {
                printf("Please enter a valid number!\n");
                clearInputBuffer();
                continue;
            }
            
            attempts++;
            
            if (guess < 1 || guess > maxNumber) {
                printf("Please enter a number between 1 and %d!\n", maxNumber);
            } else if (guess < secretNumber) {
                printf("Too low! ");
                
                // Give a hint if the guess is way off
                if (secretNumber - guess > 20) {
                    printf("You're way too low!\n");
                } else {
                    printf("Try a higher number.\n");
                }
            } else if (guess > secretNumber) {
                printf("Too high! ");
                
                // Give a hint if the guess is way off
                if (guess - secretNumber > 20) {
                    printf("You're way too high!\n");
                } else {
                    printf("Try a lower number.\n");
                }
            } else {
                hasGuessedCorrectly = true;
                int roundScore = (maxAttempts - attempts + 1) * difficulty * 10;
                score += roundScore;
                
                printf("\n");
                printf("****************************************\n");
                printf("* Congratulations! You guessed it in %d attempts!\n", attempts);
                printf("* The number was: %d\n", secretNumber);
                printf("* You earned %d points!\n", roundScore);
                printf("****************************************\n");
            }
            
            // Give a warning when running out of attempts
            if (!hasGuessedCorrectly && attempts == maxAttempts - 2) {
                printf("\nWarning: Only 2 attempts left!\n");
            }
            
            printf("\n");
        }
        
        // If player didn't guess correctly
        if (!hasGuessedCorrectly) {
            printf("Sorry, you've run out of attempts!\n");
            printf("The number was: %d\n", secretNumber);
        }
        
        // Ask if player wants to play again
        printf("\nYour total score: %d\n", score);
        printf("Would you like to play again? (1 for Yes, 0 for No): ");
        
        if (scanf("%d", &playAgain) != 1) {
            clearInputBuffer();
            playAgain = 0;
        }
        
        printf("\n");
    }
    
    printf("========================================\n");
    printf("    Thank you for playing! Final score: %d\n", score);
    printf("========================================\n");
    
    return 0;
}
